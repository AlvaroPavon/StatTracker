name: Generar Release de Producción

# Se activa cuando creas un tag v* (ej: v1.0.0)
on:
  push:
    tags:
      - 'v*'

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
    - name: Descargar código
      uses: actions/checkout@v4

    - name: Configurar PHP
      uses: shivammathur/setup-php@v2
      with:
        php-version: '8.2' # Ajustado a tu versión probable
        extensions: mbstring, intl, pdo, pdo_mysql

    - name: Instalar dependencias limpias (Producción)
      run: composer install --no-dev --optimize-autoloader --prefer-dist --no-interaction

    - name: Borrar archivos de desarrollo
      # Aquí borramos lo que NO queremos que vea el cliente final
      run: |
        rm -rf tests/
        rm -rf docs/
        rm -rf .github/
        rm -rf .git/
        rm -f .gitattributes .gitconfig .gitignore
        rm -f phpunit.xml
        rm -f composer.lock package.json
        rm -f CUMPLIMIENTO_REQUISITOS.md INSTALACION_XAMPP.md
        # Nota: Mantenemos database.sql para que puedan instalar la BD

    - name: Crear archivo ZIP
      run: zip -r stattracker-v1.0.zip .

    - name: Publicar Release en GitHub
      uses: softprops/action-gh-release@v1
      with:
        files: stattracker-v1.0.zip
        generate_release_notes: true